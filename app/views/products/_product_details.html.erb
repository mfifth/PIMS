<turbo-frame id='main'>
  <h1 class="text-3xl font-semibold text-gray-700 mb-4"><%= t('products.details.title') %></h1>

  <div class="bg-white shadow-md rounded-lg p-6 space-y-4">
    <!-- Product Name -->
    <div>
      <h2 class="text-xl font-medium text-gray-800"><%= @product.name %></h2>
      <p class="text-sm text-gray-500"><%= @product.sku %></p>
    </div>

    <!-- Category & Description -->
    <div>
      <span class="text-gray-700 font-semibold"><%= t('products.details.category') %>:</span>
      <span class="text-gray-600"><%= @product.category&.name&.titleize || t('products.details.na') %></span>
    </div>
    <div>
      <span class="text-gray-700 font-semibold"><%= t('products.details.description') %>:</span>
      <p class="text-gray-600"><%= @product.description.presence || t('products.details.no_description') %></p>
    </div>

    <!-- Perishable Status -->
    <div>
      <span class="text-gray-700 font-semibold"><%= t('products.details.perishable') %>:</span>
      <span class="<%= @product.perishable? ? 'text-red-600' : 'text-gray-600' %>">
        <%= @product.perishable? ? t('products.details.yes') : t('products.details.no') %>
      </span>
    </div>

    <!-- Inventory Information -->
    <div class="bg-gray-100 p-4 rounded-lg">
      <h3 class="text-lg mb-2 font-medium text-gray-700"><%= t('products.details.inventory_info.title') %></h3>

      <% if @locations.any? %>
        <% @locations.each do |location| %>
          <% inventory_item = @inventory_items.find { |item| item.location_id == location.id } %>
          <div class="mb-6 bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
            <!-- Location Header with Status Badge -->
            <div class="px-5 py-4 flex justify-between items-center bg-gray-50">
              <div class="flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
                <h3 class="font-medium text-gray-800"><%= location.name %></h3>
              </div>
              <span class="px-2.5 py-0.5 rounded-full text-xs font-medium <%= inventory_item ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800' %>">
                <%= inventory_item ? t('products.details.inventory_info.in_stock') : t('products.details.inventory_info.out_of_stock') %>
              </span>
            </div>

            <div class="divide-y divide-gray-100">
              <% if inventory_item %>
                <!-- Key Metrics -->
                <div class="px-5 py-3 grid grid-cols-3 gap-4">
                  <div>
                    <p class="text-xs text-gray-500 font-medium"><%= t('products.details.inventory_info.quantity') %></p>
                    <p class="text-lg font-semibold"><%= inventory_item.quantity %></p>
                  </div>
                  <div>
                    <p class="text-xs text-gray-500 font-medium"><%= t('products.details.inventory_info.unit_type') %></p>
                    <p class="text-lg font-medium"><%= inventory_item.unit_type.titleize %></p>
                  </div>
                  <div>
                    <p class="text-xs text-gray-500 font-medium"><%= t('products.details.inventory_info.total_value') %></p>
                    <p class="text-lg font-semibold"><%= number_to_currency(inventory_item.price * inventory_item.quantity) %></p>
                  </div>
                </div>

                <!-- Secondary Details -->
                <div class="px-5 py-3 grid grid-cols-2 gap-4 text-sm">
                  <div>
                    <p class="text-gray-500"><%= t('products.details.inventory_info.price') %></p>
                    <p><%= number_to_currency(inventory_item.price) %></p>
                  </div>
                  <div>
                    <p class="text-gray-500"><%= t('products.details.inventory_info.low_stock') %></p>
                    <p><%= inventory_item.low_threshold || t('products.details.na') %></p>
                  </div>
                </div>

                <!-- Batch Information - Simplified Toggle -->
                <% if @product.perishable? %>
                  <div class="px-5 py-3">
                    <button onclick="this.nextElementSibling.classList.toggle('hidden'); this.querySelector('.toggle-icon').classList.toggle('rotate-180')"
                            class="flex items-center text-gray-600 hover:text-gray-800 w-full text-sm">
                      <svg class="toggle-icon h-4 w-4 mr-2 transition-transform" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                      </svg>
                      <%= t('products.details.batch_info.title') %>
                    </button>

                    <div class="hidden mt-2 pl-6 space-y-2 text-sm">
                      <% if inventory_item.batch %>
                        <div class="flex justify-between py-1">
                          <span class="text-gray-500"><%= t('products.details.batch_info.number') %></span>
                          <span><%= inventory_item.batch.batch_number.presence || t('products.details.na') %></span>
                        </div>
                        <div class="flex justify-between py-1">
                          <span class="text-gray-500"><%= t('products.details.batch_info.manufactured') %></span>
                          <span><%= inventory_item.batch.manufactured_date&.strftime('%b %d, %Y') || t('products.details.na') %></span>
                        </div>
                        <div class="flex justify-between py-1">
                          <span class="text-gray-500"><%= t('products.details.batch_info.expiration') %></span>
                          <span class="<%= inventory_item.batch.expiring_soon? ? 'text-yellow-600' : '' %>">
                            <%= inventory_item.batch.expiration_date&.strftime('%b %d, %Y') || t('products.details.na') %>
                          </span>
                        </div>
                      <% else %>
                        <p class="text-gray-500 py-1"><%= t('products.details.batch_info.none') %></p>
                      <% end %>
                    </div>
                  </div>
                <% end %>
              <% else %>
                <div class="px-5 py-4 text-center text-gray-500">
                  <%= t('products.details.inventory_info.none') %>
                </div>
              <% end %>
            </div>
          </div>
        <% end %>
      <% else %>
        <p class="text-gray-600"><%= t('products.details.inventory_info.no_locations') %></p>
      <% end %>
    </div>

    <!-- Actions -->
    <div class="flex space-x-4 mt-4">
      <%= link_to t('products.details.actions.edit'), edit_product_path(@product), data: { turbo: false }, class: "px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700" %>
      <%= link_to t('products.details.actions.back'), products_path, data: { turbo: false }, class: "px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700" %>
      <%= link_to t('products.details.actions.delete'), product_path(@product), data: { turbo_method: :delete, turbo_frame: 'main', turbo_confirm: t('products.details.actions.confirm_delete') }, class: "px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700" %>
    </div>
  </div>
</turbo-frame>