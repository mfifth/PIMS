<turbo-frame id="main">
  <h1 class="text-3xl font-bold text-center text-gray-700 mb-6">New Order</h1>

  <% if @order && @order.errors.any? %>
    <div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-4 rounded-lg">
      <strong><%= pluralize(@order.errors.count, "error") %> prohibited this order from being saved:</strong>
      <ul class="mt-2">
        <% @order.errors.full_messages.each do |message| %>
          <li>- <%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <%= form_with(model: @order, url: orders_path, local: true, class: "space-y-6 bg-white p-8 rounded-lg shadow-xl border border-gray-300") do |form| %>

    <!-- Location Selection -->
    <div data-controller="order-item-search">
      <%= form.label :location_id, "Location", class: "block text-sm font-medium text-gray-700" %>
      <%= form.select :location_id,
          options_from_collection_for_select(@locations, :id, :name),
          { include_blank: "Select a location" },
          class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",
          data: { "order-item-search-target": "location" } %>

      <!-- Inventory Search -->
      <div class="mt-6 space-y-4">
        <%= label_tag :inventory_search, "Search for products or recipes", class: "block text-sm font-medium text-gray-700" %>
        <%= text_field_tag :inventory_search,
            "",
            placeholder: "Type to search...",
            autocomplete: "off",
            class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",
            data: {
              order_item_search_target: "input",
              action: "input->order-item-search#search"
            } %>

        <ul data-order-item-search-target="results" class="border border-gray-300 rounded mt-1 max-h-48 overflow-auto bg-white"></ul>

        <!-- Selected Items -->
        <h3 class="text-lg font-semibold mt-4">Selected Items</h3>
        <div data-order-item-search-target="itemsList" class="space-y-2 border border-gray-200 rounded p-4 bg-gray-50"></div>

        <!-- Hidden Inputs -->
        <div data-order-item-search-target="hiddenInputs"></div>

        <!-- Total -->
        <div class="text-right text-lg font-bold mt-4">
          <span data-order-item-search-target="total">Total: $0.00</span>
        </div>
      </div>
    </div>

    <!-- Submit Buttons -->
    <div class="mt-6 flex space-x-4">
      <%= form.submit "Create Order", class: "bg-blue w-full py-2 px-4 text-white bg-blue-600 hover:bg-blue-700 rounded-lg transition" %>
      <%= link_to "Cancel", orders_path, class: "w-full py-2 px-4 text-center text-gray-700 bg-gray-200 hover:bg-gray-300 rounded-lg transition" %>
    </div>

  <% end %>
</turbo-frame>
