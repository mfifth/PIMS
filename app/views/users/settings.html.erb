<% product_limit = Current.account.product_plan_limit %>
<% user_limit = Current.account.user_plan_limit %>

<div class="max-w-2xl mx-auto bg-white p-8 rounded-lg shadow-xl border border-gray-300">
  <h1 class="text-2xl font-semibold mb-6 text-gray-800">Account Settings</h1>

  <%= render 'subscription_display', product_limit: product_limit, user_limit: user_limit %>

  <turbo-frame id="account_settings">
    <%= render "form" %>
  </turbo-frame>

  <!-- Invite a User -->
  <div class="max-w-2xl mx-auto mt-10 border-t">
    <h2 class="text-lg font-semibold mb-4 text-gray-800">Invite a User to Your Account</h2>

    <%= form_with model: Invitation.new, method: :post, local: true, class: "space-y-6 bg-white p-6 shadow-sm rounded-xl border border-gray-200" do |form| %>
      <div>
        <%= form.label :email, "User Email", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= form.email_field :email, required: true, class: "w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500" %>
      </div>

      <div>
        <%= form.label :role, "Role", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= form.select :role, options_for_select([["User", "user"], ["Admin", "admin"]]), {}, class: "w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500" %>
      </div>

      <div class="flex justify-end">
        <%= form.submit "Send Invite", class: "bg-blue bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition", disabled: @invitations.size >= user_limit %>
      </div>
    <% end %>
  </div>

  <!-- Invited Users List -->
  <div class="max-w-2xl mx-auto mt-16">
    <h2 class="text-lg font-semibold mb-4 text-gray-800">Invited Users</h2>

    <% if @invitations.any? %>
      <table class="w-full table-auto border-collapse">
        <thead>
          <tr class="text-left">
            <th class="px-4 py-2 border-b font-semibold text-gray-700">Email</th>
            <th class="px-4 py-2 border-b font-semibold text-gray-700">Role</th>
            <th class="px-4 py-2 border-b font-semibold text-gray-700">Status</th>
          </tr>
        </thead>
        <tbody>
          <% @invitations.each do |invitation| %>
            <tr id="invitation_<%= invitation.id %>" class="hover:bg-gray-100">
              <td class="px-4 py-2 border-b text-gray-700"><%= invitation.email %></td>
              <td class="px-4 py-2 border-b text-gray-700"><%= invitation.role.capitalize %></td>
              <td class="px-4 py-2 border-b text-gray-700">
                <% if invitation.confirmed_at %>
                  <span class="text-green-500 font-semibold">Accepted</span>
                <% else %>
                  <span class="text-red-500 font-semibold">Pending</span>
                <% end %>
              </td>
              <td class="px-4 py-2 border-b text-gray-700">
                <%= link_to 'Delete', invitation_path(invitation), data: { turbo_confirm: 'Are you sure you want to delete this invitation?', turbo_method: :delete }, class: "text-red-500 hover:text-red-700" %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    <% else %>
      <p class="text-gray-500">No users have been invited yet.</p>
    <% end %>

    <% if @invitations.size >= user_limit %>
      <p class="text-red-500 text-sm mt-2">You have reached the maximum number of invited users for your plan.</p>
    <% end %>
  </div>
</div>
