<turbo-frame id='main'>
  <div class="flex justify-between items-center mb-4">
    <h1 style='font-size: x-large;' class="text-3xl font-semibold text-gray-700">Batches</h1>
    <%= link_to 'New Batch', new_batch_path, class: "bg-green text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition" %>
  </div>

  <!-- Search Bar -->
  <div style='background-color: white;' class="mb-4 rounded">
    <%= form_with url: batches_path, method: :get, local: true, class: "flex space-x-2" do |form| %>
      <%= form.text_field :query, value: params[:query], placeholder: "Search by Batch Number, Expiration Date, or Product Name", class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" %>
      <%= form.submit "Search", class: "bg-blue bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition" %>
    <% end %>
  </div>

  <!-- Batch List -->
  <div data-controller="infinite-batch-scroll"
     data-infinite-batch-scroll-url-value="<%= @batches.next_page ? batches_path(page: @batches.next_page, format: :turbo_stream) : '' %>"
     data-infinite-batch-scroll-container-value="#batches-list">

    <%= turbo_frame_tag "batches" do %>
      <div id="batches-list">
        <%= render @batches %>
      </div>
    <% end %>

    <%= render partial: "batches/next_page_metadata", locals: { next_page: @batches.next_page } %>

    <div id="loading" class="hidden text-center py-4 text-gray-500">
      Loading more batches...
    </div>
  </div>
</turbo-frame>
