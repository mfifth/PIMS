<turbo-frame id='main'>
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-2xl font-bold"><%= t("recipes.index.title") %></h1>

    <div class="flex space-x-2">
      <%= link_to t("recipes.index.new_recipe"), new_recipe_path,
            class: "bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-md", style: "height: fit-content;" %>

      <%= form_with url: import_recipes_recipes_path,
            method: :post,
            html: { multipart: true },
            class: "flex",
            data: {
              turbo: false,
              controller: "file",
              action: "change->file#submit"
            } do |f| %>
        <div class="relative">
          <%= f.file_field :file,
                accept: ".csv",
                class: "hidden",
                id: "csv-upload-recipes",
                data: { file_target: "input" } %>
          <label for="csv-upload-recipes"
                class="bg-green hover:bg-green text-white px-4 py-2 rounded-lg transition flex items-center cursor-pointer whitespace-nowrap"
                data-file-target="label">
            <span data-file-target="text"><%= t("recipes.index.import_recipes", default: "Import Recipes") %></span>
            <span class="ml-2 hidden" data-file-target="spinner">
              <svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor"
                  d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 
                  1.135 5.824 3 7.938l3-2.647z"></path>
              </svg>
            </span>
          </label>
          <%= link_to sample_csv_recipes_path,
            class: "text-blue-600 hover:text-blue-800 text-sm flex items-center",
            style: "margin-top: 10px;",
            download: "sample_recipes.csv" do %>
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
            </svg>
            <%= t("locations.show.download_sample") %>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>

  <%= form_with url: recipes_path, method: :get, local: true, class: "mb-6" do |f| %>
    <div class="relative rounded-lg bg-white">
      <%= f.text_field :search, 
            placeholder: t("recipes.index.search_placeholder"),
            value: params[:search], autocomplete: "off",
            class: "w-full rounded-lg border-gray-300 pl-10 pr-4 py-2 border focus:ring-blue-500 focus:border-blue-500" %>
      <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
        <svg class="h-5 w-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd"></path>
        </svg>
      </div>
    </div>
  <% end %>

  <% if recipes.blank? %>
    <div class="bg-white rounded-lg shadow p-6 text-center">
      <% if params[:search].present? %>
        <p class="text-gray-500 mb-4"><%= t("recipes.index.no_match", query: params[:search]) %></p>
      <% else %>
        <p class="text-gray-500 mb-4"><%= t("recipes.index.no_recipes") %></p>
      <% end %>
      <%= link_to t("recipes.index.create_first"), new_recipe_path, class: "bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-md inline-block" %>
    </div>
  <% else %>
    <div class="space-y-6 recipe-card">
      <% recipes.each do |recipe| %>
        <%= render partial: "recipe_card", locals: { recipe: recipe } %>
      <% end %>
    </div>
  <% end %>
</turbo-frame>