<turbo-frame id='main'>
  <div class="max-w-3xl mx-auto bg-white p-8 rounded-lg shadow-md">
    <!-- Location Header -->
    <h1 class="text-3xl font-bold text-gray-800 mb-4"><%= @location.name %></h1>

    <!-- Address Details -->
    <div class="text-gray-700 space-y-2 mb-6">
      <p><strong class="font-semibold">Address:</strong> <%= @location.address %></p>
      <p><strong class="font-semibold">City:</strong> <%= @location.city %></p>
    </div>

    <hr class="border-gray-300 mb-6">

    <!-- Inventory Section -->
    <% if @inventory_items.any? %>
      <h2 class="text-2xl font-semibold text-gray-800 mb-4">Inventory Items</h2>
    <% end %>

    <div class="space-y-6">
      <% total_inventory_value = 0 %> <!-- To hold the sum of all inventory prices -->
      <% @inventory_items.group_by(&:product).each do |product, items| %>
        <div class="bg-gray-50 p-6 rounded-lg shadow hover:shadow-lg transition-all">
          <div class="flex justify-between items-center text-gray-800">
            <span class="font-semibold text-lg"><%= product.name %></span>
            <span class="text-gray-600 text-sm">Total Quantity: <%= items.sum(&:quantity) %></span>
          </div>

          <!-- Category -->
          <div class="mt-3 text-gray-600 text-sm">
            <% if product.category.present? %>
              <p><strong>Category:</strong> <%= product.category.name&.capitalize %></p>
            <% else %>
              <p class="italic text-gray-500">No category assigned</p>
            <% end %>
          </div>

          <!-- Price and Total Value Calculation -->
          <div class="mt-4 text-gray-700">
            <p><strong>Price:</strong> <%= number_to_currency(product.price) %></p>
            <strong>Total:</strong> <%= number_to_currency(items.sum { |item| item.quantity * product.price }) %>
          </div>

          <!-- Batch Information (for perishable products) -->
          <% if product.perishable? %>
            <div class="mt-4">
              <strong class="text-gray-700">Batch Information:</strong>
              <ul class="list-disc pl-5 text-sm text-gray-600 mt-2 space-y-1">
                <% items.each do |item| %>
                  <li>
                    <%= "Batch #{item.product.batch.batch_number} (Manufactured: #{item.product.batch.manufactured_date}, Expiration: #{item.product.batch.expiration_date})" %>
                  </li>
                <% end %>
              </ul>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>

    <!-- Action Buttons -->
    <div class="mt-8 flex space-x-4">
      <%= link_to 'Edit Location', edit_location_path(@location), class: "bg-yellow-500 text-white px-4 py-2 rounded-lg hover:bg-yellow-600 transition" %>
      <%= link_to 'Back to Locations', locations_path, class: "bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition" %>
    </div>
  </div>
</turbo-frame>
